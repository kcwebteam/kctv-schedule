var KCTVScheduleWidget=function(e){"use strict";function t(e){for(var t in e)e.hasOwnProperty(t)&&(g[t]=e[t]);n("/Globals/feeds/kctv-schedule.aspx")}function a(t){var a=r(g.xml),n=l(a,g.activeDay),c=g.headerOn?s(t):"";e(g.id).html(c+n)}function n(t){var n="",r=e.ajax({type:"GET",url:t,crossDomain:!0,dataType:"xml",success:function(e){return g.xml=e,a(g.activeDay),n},error:function(e,t,a){console.log(t+a)}});return r.done(function(e){n=e}),r.fail(function(e,t){console.log("Request failed: "+t+e.status)}),n}function r(e){var t=new X2JS,a=t.xml2json(e);return a}function s(e){function t(e,t){var n="",r=new Date;return r=v(a,e-t),n=e===t?d(t):'<a href="?day='+r.toLocaleDateString()+'">'+d(e)+"</a>","<li>"+n+"</li>"}var a=new Date(e),n=a.getDay(),r=new Date,s=new Date,l="",c="";r=v(a,-7),s=v(a,7);var i=new Date;i.setHours("00"),i.setMinutes("00"),i.setSeconds("00"),i.setMilliseconds("00"),g.earliestEvent.valueOf()<v(a,-n).valueOf()&&(l='<a href="?day='+r.toLocaleDateString()+'">Previous Week</a>'),g.latestEvent.valueOf()>v(a,6-n).valueOf()&&(c='<a href="?day='+s.toLocaleDateString()+'">Next Week</a>');var o,u='<div class="schednav_ng"><div class="tvweeks_ng"><div class="column_ng prev_ng ">'+l+'</div><div class="column_ng tvdate_ng">'+d(n)+" - "+a.toLocaleDateString()+'</div><div class="column_ng next_ng">'+c+'</div></div><div class="clear"></div><ul class="tvweekdays_ng">';for(o=0;7>o;o+=1)u+=t(o,n);return u+="</ul></div>"}function l(e,t){var a,n="",r=!0,s=new Date(t),l=(s.toLocaleDateString(),d(s)),i=u(s);n+='<table id="tvschedule" border="0" cellpadding="0" class="datatable tvsched_ng" summary="King County Television Schedule">',n+=g.headerOn?"<caption>":'<caption class="noHeader">',n+="What's on today: "+l+", "+i+" "+s.getDate()+"</caption>",n+="<thead><tr>",n+='<th scope="cols" class="airtime_ng">Time</th><th scope="cols" class="title_ng">Title</th>',n+="</tr></thead>",n+="<tbody>",n+=g.headerOn?"":'<tr id="tvschedscroll" class="tvschedscroll_g">';for(var o,v=0;v<e.tv.programme.length;v+=1)if(!(c(e.tv.programme[v]._start,e.tv.programme[v]._stop)<6e5)){a=e.tv.programme[v].title;var f=e.tv.programme[v]._start.slice(6,8),h=e.tv.programme[v]._start.slice(4,6),m=e.tv.programme[v]._start.slice(0,4),o=moment(e.tv.programme[v]._start,"YYYYMMDDHHmmss").add(1,"seconds").format("LT"),y=new Date(m,h-1,f),p=new Date(s);p.setHours(0,0,0,0),y.valueOf()===p.valueOf()&&(n+=v%2===0?"<tr>":'<tr class="odd">',n+='<td class="airtime_ng">'+o+"</td>",n+='<td class="title_ng">'+a+"</td>",n+="</tr>",r=!1),y.valueOf()<g.earliestEvent.valueOf()&&(g.earliestEvent=y),y.valueOf()>g.latestEvent.valueOf()&&(g.latestEvent=y)}return r&&(n+="<tr><td>Schedule Currently Not Available</td><td></td></tr>"),n+=g.headerOn?"":"</tr>",n+="</tbody><tfoot><tr>",n+='<td colspan="2">Schedules subject to change, depending on the length of live programming.</td>',n+="</tr></tfoot>",n+="</table>",n+=g.headerOn?"":'<div class="tvschedlinks_g"><a href="/KCTV/schedule.aspx">Search TV Schedule</a></div>'}function c(e,t){var a,n=e.slice(6,8),r=e.slice(4,6),s=e.slice(0,4),l=e.slice(8,10),c=e.slice(10,12),i=e.slice(12,14),o=t.slice(6,8),d=t.slice(4,6),u=t.slice(0,4),v=t.slice(8,10),g=t.slice(10,12),f=t.slice(12,14),h=new Date,m=new Date;return h.setFullYear(s),h.setMonth(r-1),h.setDate(n),h.setHours(l),h.setMinutes(c),h.setSeconds(i),m.setFullYear(u),m.setMonth(d-1),m.setDate(o),m.setHours(v),m.setMinutes(g),m.setSeconds(f),a=m-h}function i(e){var t=(new Date).toLocaleDateString();return"undefined"==typeof o(e)||""===o(e)?t:o(e)}function o(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),a=t.exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}function d(e){var t=new Array(7);return t[0]="Sunday",t[1]="Monday",t[2]="Tuesday",t[3]="Wednesday",t[4]="Thursday",t[5]="Friday",t[6]="Saturday","number"==typeof e?t[e]:t[e.getDay()]}function u(e){var t=[];return t[0]="January",t[1]="February",t[2]="March",t[3]="April",t[4]="May",t[5]="June",t[6]="July",t[7]="August",t[8]="September",t[9]="October",t[10]="November",t[11]="December",t[e.getMonth()]}function v(e,t){var a=new Date;return a.setTime(e.getTime()+864e5*t),a}var g={xml:"",id:"#KCTVSchedule",activeDay:i("day"),earliestEvent:new Date,latestEvent:new Date("1/1/2000"),headerOn:!0};return{init:t}}(jQuery);$(function(){KCTVScheduleWidget.init({headerOn:!0,id:"#KCTVSchedule"})});